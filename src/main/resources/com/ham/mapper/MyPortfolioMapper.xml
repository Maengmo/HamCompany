<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ham.mapper.MyPortfolioMapper">

	<insert id="add">
		
		<selectKey keyProperty="p_seq" order="BEFORE" resultType="String">
			select p_seq.nextval from dual
		</selectKey>
		
		insert into tblPortfolio (p_seq, m_id, p_subject, p_service, p_location, p_time, p_year)
			values (#{p_seq}, #{m_id}, #{p_subject}, #{p_service}, #{p_location}, #{p_time}, #{p_year})
		
	</insert>
	
	<insert id="addGallery">
	
		insert into tblPGallery (pg_seq, pg_name, p_seq)
			values(pg_seq.nextval, #{pg_name}, #{p_seq})
		
	</insert>
	
	<resultMap type="com.ham.domain.MyPGalleryDTO" id="galleryMap">
		<id property="pg_seq" column="pg_seq"/>
		<result property="pg_seq" column="pg_seq"/>
		<result property="pg_name" column="pg_name"/>
		<result property="p_seq" column="p_seq"/>
	</resultMap>
	
	<resultMap type="com.ham.domain.MyPortfolioDTO" id="portfolioMap">
		<id property="p_seq" column="p_seq"/>
		<result property="p_seq" column="p_seq" />
		<result property="m_id" column="m_id" />
		<result property="p_subject" column="p_subject" />
		<result property="p_service" column="p_service" />
		<result property="p_location" column="p_location" />
		<result property="p_time" column="p_time" />
		<result property="p_year" column="p_year" />
		<collection property="gallery" resultMap="galleryMap"/>
	</resultMap>
	
	<select id="list" resultMap="portfolioMap">
		select 
		    p.p_seq,
		    p.m_id,
		    p.p_subject,
		    p.p_service,
		    p.p_location,
		    p.p_time,
		    p.p_year,
		    pg.pg_seq,
		    pg.pg_name
		from tblPortfolio p
		    left outer join tblPGallery pg
		        on p.p_seq = pg.p_seq
		where p.m_id=#{id}
		    order by p.p_seq, pg.pg_seq
	</select>
	
	<select id="edit" resultMap="portfolioMap">
		select 
		    p.p_seq,
		    p.m_id,
		    p.p_subject,
		    p.p_service,
		    p.p_location,
		    p.p_time,
		    p.p_year,
		    pg.pg_seq,
		    pg.pg_name
		from tblPortfolio p
		    left outer join tblPGallery pg
		        on p.p_seq = pg.p_seq
		where p.p_seq=#{p_seq}
		    order by p.p_seq, pg.pg_seq
	</select>
	
	<select id="getgallery" resultType="com.ham.domain.MyPGalleryDTO">
		select 
			pg_seq,
			pg_name,
			p_seq
		from tblPGallery
			where p_seq = #{p_seq}
		    	order by pg_seq		
	</select>	
	
	<delete id="delFile">
		delete from tblPGallery
			where pg_name=#{name}	
	</delete>
	
	<update id="update">		
		update tblPortfolio set
			p_subject = #{p_subject}, 
			p_service = #{p_service}, 
			p_location = #{p_location}, 
			p_time = #{p_time}, 
			p_year = #{p_year}
				where p_seq = #{p_seq}		
	</update>
	
	<insert id="updateGallery">	
		insert into tblPGallery (pg_seq, pg_name, p_seq)
			values(pg_seq.nextval, #{pg_name}, #{p_seq})		
	</insert>
	
	<delete id="delete">
		delete from tblPortfolio 
			where p_seq=#{p_seq}
	</delete>
	
	<delete id="deleteGallery">
		delete from tblPGallery
			where p_seq=#{p_seq}
	</delete>

</mapper>